-- migrate:up
CREATE TABLE if not exists events_rmt (
`id` UUID COMMENT 'unique event id' CODEC(LZ4),
`type` LowCardinality(FixedString(32)) COMMENT 'type of the event' CODEC(ZSTD(3)),
`session_id` UUID COMMENT 'associated session id' CODEC(LZ4),
`team_id` UUID COMMENT 'associated team id' CODEC(LZ4),
`app_id` UUID COMMENT 'associated app id',
`inserted_at` DateTime64(3, 'UTC') DEFAULT now64() COMMENT 'original event insertion timestamp' CODEC(Delta, ZSTD(3)),
`inet.ipv4` Nullable(IPv4) COMMENT 'ipv4 address' CODEC(ZSTD(3)),
`inet.ipv6` Nullable(IPv6) COMMENT 'ipv6 address' CODEC(ZSTD(3)),
`inet.country_code` LowCardinality(FixedString(8)) COMMENT 'country code' CODEC(ZSTD(3)),
`timestamp` DateTime64(9,
'UTC') COMMENT 'event timestamp' CODEC(DoubleDelta,
ZSTD(3)),
`user_triggered` Bool COMMENT 'true if user chose to trigger by themselves' CODEC(ZSTD(3)),
`attribute.installation_id` UUID COMMENT 'unique id for an installation of an app, generated by sdk' CODEC(LZ4),
`attribute.app_version` LowCardinality(FixedString(128)) COMMENT 'app version identifier' CODEC(ZSTD(3)),
`attribute.app_build` FixedString(32) COMMENT 'app build identifier' CODEC(ZSTD(3)),
`attribute.app_unique_id` LowCardinality(FixedString(128)) COMMENT 'app bundle identifier' CODEC(ZSTD(3)),
`attribute.platform` LowCardinality(FixedString(32)) COMMENT 'platform identifier' CODEC(ZSTD(3)),
`attribute.measure_sdk_version` FixedString(16) COMMENT 'measure sdk version identifier' CODEC(ZSTD(3)),
`attribute.thread_name` FixedString(128) COMMENT 'thread on which the event was captured' CODEC(ZSTD(3)),
`attribute.user_id` FixedString(128) COMMENT 'id of the app\'s end user' CODEC(ZSTD(3)),
`attribute.device_name` FixedString(32) COMMENT 'name of the device' CODEC(ZSTD(3)),
`attribute.device_model` FixedString(32) COMMENT 'model of the device' CODEC(ZSTD(3)),
`attribute.device_manufacturer` FixedString(32) COMMENT 'manufacturer of the device' CODEC(ZSTD(3)),
`attribute.device_type` LowCardinality(FixedString(32)) COMMENT 'type of the device, like phone or tablet' CODEC(ZSTD(3)),
`attribute.device_is_foldable` Bool COMMENT 'true for foldable devices' CODEC(ZSTD(3)),
`attribute.device_is_physical` Bool COMMENT 'true for physical devices' CODEC(ZSTD(3)),
`attribute.device_density_dpi` UInt16 COMMENT 'dpi density' CODEC(Delta(2),
ZSTD(3)),
`attribute.device_width_px` UInt16 COMMENT 'screen width' CODEC(Delta(2),
ZSTD(3)),
`attribute.device_height_px` UInt16 COMMENT 'screen height' CODEC(Delta(2),
ZSTD(3)),
`attribute.device_density` Float32 COMMENT 'device density' CODEC(Delta(4),
ZSTD(3)),
`attribute.device_locale` LowCardinality(FixedString(64)) COMMENT 'rfc 5646 locale string' CODEC(ZSTD(3)),
`attribute.device_low_power_mode` Bool COMMENT 'true if low power mode is enabled',
`attribute.device_thermal_throttling_enabled` Bool COMMENT 'true if thermal throttling is enabled',
`attribute.device_cpu_arch` LowCardinality(FixedString(16)) COMMENT 'cpu architecture like arm64 and so on',
`attribute.os_name` LowCardinality(FixedString(32)) COMMENT 'name of the operating system' CODEC(ZSTD(3)),
`attribute.os_version` FixedString(32) COMMENT 'version of the operating system' CODEC(ZSTD(3)),
`attribute.os_page_size` UInt8 COMMENT 'memory_page_size' CODEC(Delta(1),
ZSTD (3)),
`attribute.network_type` LowCardinality(FixedString(16)) COMMENT 'either - wifi, cellular, vpn, unknown, no_network' CODEC(ZSTD(3)),
`attribute.network_generation` LowCardinality(FixedString(8)) COMMENT 'either - 2g, 3g, 4g, 5g, unknown' CODEC(ZSTD(3)),
`attribute.network_provider` FixedString(64) COMMENT 'name of the network service provider' CODEC(ZSTD(3)),
`user_defined_attribute` Map(
LowCardinality(String),
Tuple(
Enum8(
'string' = 1,
'int64' = 2,
'float64' = 3,
'bool' = 4
),
String
)
) COMMENT 'user defined attributes' CODEC(ZSTD(3)),
`anr.handled` Bool COMMENT 'anr was handled by the application code' CODEC(ZSTD(3)),
`anr.fingerprint` FixedString(32) COMMENT 'fingerprint for anr similarity classification' CODEC(ZSTD(3)),
`anr.exceptions` String COMMENT 'anr exception data' CODEC(ZSTD(3)),
`anr.threads` String COMMENT 'anr thread data' CODEC(ZSTD(3)),
`anr.foreground` Bool COMMENT 'true if the anr was perceived by end user' CODEC(ZSTD(3)),
`exception.handled` Bool COMMENT 'exception was handled by application code' CODEC(ZSTD(3)),
`exception.fingerprint` FixedString (32) COMMENT 'fingerprint for exception similarity classification' CODEC(ZSTD(3)),
`exception.exceptions` String COMMENT 'exception data' CODEC(ZSTD(3)),
`exception.threads` String COMMENT 'exception thread data' CODEC(ZSTD(3)),
`exception.foreground` Bool COMMENT 'true if the exception was perceived by end user' CODEC(ZSTD(3)),
`exception.framework` FixedString(16) COMMENT 'the framework in which the exception was thrown',
`exception.binary_images` String COMMENT 'list of apple crash binary images',
`exception.error` String COMMENT 'general error data',
`app_exit.reason` LowCardinality(FixedString(64)) COMMENT 'reason for app exit' CODEC(ZSTD(3)),
`app_exit.importance` LowCardinality(FixedString(32)) COMMENT 'importance of process that it used to have before death' CODEC(ZSTD(3)),
`app_exit.trace` String COMMENT 'modified trace given by ApplicationExitInfo to help debug anrs.' CODEC (ZSTD (3)),
`app_exit.process_name` String COMMENT 'name of the process that died' CODEC (ZSTD (3)),
`app_exit.pid` String COMMENT 'id of the process that died' CODEC (ZSTD (3)),
`string.severity_text` LowCardinality (FixedString (10)) COMMENT 'log level - info, warning, error, fatal, debug' CODEC (ZSTD (3)),
`string.string` String COMMENT 'log message text' CODEC (ZSTD (3)),
`gesture_long_click.target` FixedString (128) COMMENT 'class or instance name of the originating view' CODEC (ZSTD (3)),
`gesture_long_click.target_id` FixedString (128) COMMENT 'unique identifier of the target' CODEC (ZSTD (3)),
`gesture_long_click.touch_down_time` UInt64 COMMENT 'time for touch down gesture' CODEC (T64,
ZSTD (3)),
`gesture_long_click.touch_up_time` UInt64 COMMENT 'time for touch up gesture' CODEC (T64,
ZSTD (3)),
`gesture_long_click.width` UInt16 COMMENT 'width of the target view in pixels' CODEC (T64,
ZSTD (3)),
`gesture_long_click.height` UInt16 COMMENT 'height of the target view in pixels' CODEC (T64,
ZSTD (3)),
`gesture_long_click.x` Float32 COMMENT 'x coordinate of where the gesture happened' CODEC (Delta (4),
ZSTD (3)),
`gesture_long_click.y` Float32 COMMENT 'y coordinate of where the gesture happened' CODEC (Delta (4),
ZSTD (3)),
`gesture_click.target` FixedString (128) COMMENT 'class or instance name of the originating view' CODEC (ZSTD (3)),
`gesture_click.target_id` FixedString (128) COMMENT 'unique identifier of the target' CODEC (ZSTD (3)),
`gesture_click.touch_down_time` UInt64 COMMENT 'time for touch down gesture' CODEC (T64,
ZSTD (3)),
`gesture_click.touch_up_time` UInt64 COMMENT 'time for the touch up gesture' CODEC (T64,
ZSTD (3)),
`gesture_click.width` UInt16 COMMENT 'width of the target view in pixels' CODEC (Delta (2),
ZSTD (3)),
`gesture_click.height` UInt16 COMMENT 'height of the target view in pixels' CODEC (Delta (2),
ZSTD (3)),
`gesture_click.x` Float32 COMMENT 'x coordinate of where the gesture happened' CODEC (Delta (4),
ZSTD (3)),
`gesture_click.y` Float32 COMMENT 'y coordinate of where the gesture happened' CODEC (Delta (4),
ZSTD (3)),
`gesture_scroll.target` FixedString (128) COMMENT 'class or instance name of the originating view' CODEC (ZSTD (3)),
`gesture_scroll.target_id` FixedString (128) COMMENT 'unique identifier of the target' CODEC (ZSTD (3)),
`gesture_scroll.touch_down_time` UInt64 COMMENT 'time for touch down gesture' CODEC (T64,
ZSTD (3)),
`gesture_scroll.touch_up_time` UInt64 COMMENT 'time for touch up gesture' CODEC (T64,
ZSTD (3)),
`gesture_scroll.x` Float32 COMMENT 'x coordinate of where the gesture started' CODEC (Delta (4),
ZSTD (3)),
`gesture_scroll.y` Float32 COMMENT 'y coordinate of where the gesture started' CODEC (Delta (4),
ZSTD (3)),
`gesture_scroll.end_x` Float32 COMMENT 'x coordinate of where the gesture ended' CODEC (Delta (4),
ZSTD (3)),
`gesture_scroll.end_y` Float32 COMMENT 'y coordinate of where the gesture ended' CODEC (Delta (4),
ZSTD (3)),
`gesture_scroll.direction` LowCardinality (FixedString (8)) COMMENT 'direction of the scroll' CODEC (ZSTD (3)),
`lifecycle_activity.type` LowCardinality (FixedString (32)) COMMENT 'type of the lifecycle activity, either - created, resumed, paused, destroyed' CODEC (ZSTD (3)),
`lifecycle_activity.class_name` FixedString (128) COMMENT 'fully qualified class name of the activity' CODEC (ZSTD (3)),
`lifecycle_activity.intent` String COMMENT 'intent data serialized as string' CODEC (ZSTD (3)),
`lifecycle_activity.saved_instance_state` Bool COMMENT 'represents that activity was recreated with a saved state. only available for type created.' CODEC (ZSTD (3)),
`lifecycle_fragment.type` LowCardinality (FixedString (32)) COMMENT 'type of the lifecycle fragment, either - attached, resumed, paused, detached' CODEC (ZSTD (3)),
`lifecycle_fragment.class_name` FixedString (128) COMMENT 'fully qualified class name of the fragment' CODEC (ZSTD (3)),
`lifecycle_fragment.parent_activity` String COMMENT 'fully qualified class name of the parent activity that the fragment is attached to' CODEC (ZSTD (3)),
`lifecycle_fragment.parent_fragment` String COMMENT 'fully qualified class name of the parent fragment that the fragment is attached to' CODEC (ZSTD (3)),
`lifecycle_fragment.tag` String COMMENT 'optional fragment tag' CODEC (ZSTD (3)),
`lifecycle_view_controller.type` LowCardinality (FixedString (32)) COMMENT 'type of the iOS ViewController lifecycle event',
`lifecycle_view_controller.class_name` LowCardinality (FixedString (256)) COMMENT 'class name of the iOS ViewController lifecycle event',
`lifecycle_swift_ui.type` LowCardinality (FixedString (16)) COMMENT 'type of the iOS SwiftUI view lifecycle event',
`lifecycle_swift_ui.class_name` LowCardinality (FixedString (256)) COMMENT 'class name of the iOS SwiftUI view lifecycle event',
`lifecycle_app.type` LowCardinality (FixedString (32)) COMMENT 'type of the lifecycle app, either - background, foreground' CODEC (ZSTD (3)),
`cold_launch.process_start_uptime` UInt64 COMMENT 'start uptime in msec' CODEC (T64,
ZSTD (3)),
`cold_launch.process_start_requested_uptime` UInt64 COMMENT 'start uptime in msec' CODEC (T64,
ZSTD (3)),
`cold_launch.content_provider_attach_uptime` UInt64 COMMENT 'start uptime in msec' CODEC (T64,
ZSTD (3)),
`cold_launch.on_next_draw_uptime` UInt64 COMMENT 'time at which app became visible' CODEC (T64,
ZSTD (3)),
`cold_launch.launched_activity` FixedString (128) COMMENT 'activity which drew the first frame during cold launch' CODEC (ZSTD (3)),
`cold_launch.has_saved_state` Bool COMMENT 'whether the launched_activity was created with a saved state bundle' CODEC (ZSTD (3)),
`cold_launch.intent_data` String COMMENT 'intent data used to launch the launched_activity' CODEC (ZSTD (3)),
`cold_launch.duration` UInt32 COMMENT 'computed cold launch duration' CODEC (T64,
ZSTD (3)),
`warm_launch.app_visible_uptime` UInt64 COMMENT 'time since the app became visible to user, in msec',
`warm_launch.process_start_uptime` UInt64 COMMENT 'start uptime in msec' CODEC (T64,
ZSTD (3)),
`warm_launch.process_start_requested_uptime` UInt64 COMMENT 'start uptime in msec' CODEC (T64,
ZSTD (3)),
`warm_launch.content_provider_attach_uptime` UInt64 COMMENT 'start uptime in msec' CODEC (T64,
ZSTD (3)),
`warm_launch.on_next_draw_uptime` UInt64 COMMENT 'time at which app became visible to user, in msec' CODEC (ZSTD (3)),
`warm_launch.launched_activity` FixedString (128) COMMENT 'activity which drew the first frame during warm launch' CODEC (ZSTD (3)),
`warm_launch.has_saved_state` Bool COMMENT 'whether the launched_activity was created with a saved state bundle' CODEC (ZSTD (3)),
`warm_launch.intent_data` String COMMENT 'intent data used to launch the launched_activity' CODEC (ZSTD (3)),
`warm_launch.duration` UInt32 COMMENT 'computed warm launch duration' CODEC (T64,
ZSTD (3)),
`warm_launch.is_lukewarm` Bool COMMENT 'whether it is a lukewarm launch' CODEC (ZSTD (3)),
`hot_launch.app_visible_uptime` UInt64 COMMENT 'time elapsed since the app became visible to user, in msec' CODEC (T64,
ZSTD (3)),
`hot_launch.on_next_draw_uptime` UInt64 COMMENT 'time at which app became visible to user, in msec' CODEC (T64,
ZSTD (3)),
`hot_launch.launched_activity` FixedString (128) COMMENT 'activity which drew the first frame during hot launch' CODEC (ZSTD (3)),
`hot_launch.has_saved_state` Bool COMMENT 'whether the launched_activity was created with a saved state bundle' CODEC (ZSTD (3)),
`hot_launch.intent_data` String COMMENT 'intent data used to launch the launched_activity' CODEC (ZSTD (3)),
`hot_launch.duration` UInt32 COMMENT 'computed hot launch duration' CODEC (T64,
ZSTD (3)),
`network_change.network_type` LowCardinality (FixedString (16)) COMMENT 'type of the network, wifi, cellular etc' CODEC (ZSTD (3)),
`network_change.previous_network_type` LowCardinality (FixedString (16)) COMMENT 'type of the previous network' CODEC (ZSTD (3)),
`network_change.network_generation` LowCardinality (FixedString (8)) COMMENT '2g, 3g, 4g etc' CODEC (ZSTD (3)),
`network_change.previous_network_generation` LowCardinality (FixedString (8)) COMMENT 'previous network generation' CODEC (ZSTD (3)),
`network_change.network_provider` FixedString (64) COMMENT 'name of the network service provider' CODEC (ZSTD (3)),
`http.url` String COMMENT 'url of the http request' CODEC (ZSTD (3)),
`http.method` LowCardinality (FixedString (16)) COMMENT 'method like get, post' CODEC (ZSTD (3)),
`http.status_code` UInt16 COMMENT 'http status code' CODEC (T64, ZSTD (3)),
`http.start_time` UInt64 COMMENT 'uptime at when the http call started, in msec' CODEC (T64,
ZSTD (3)),
`http.end_time` UInt64 COMMENT 'uptime at when the http call ended, in msec' CODEC (T64,
ZSTD (3)),
`http_request_headers` Map (String,
String) COMMENT 'http request headers' CODEC (ZSTD (3)),
`http_response_headers` Map (String,
String) COMMENT 'http response headers' CODEC (ZSTD (3)),
`http.request_body` String COMMENT 'request body' CODEC (ZSTD (3)),
`http.response_body` String COMMENT 'response body' CODEC (ZSTD (3)),
`http.failure_reason` String COMMENT 'reason for failure' CODEC (ZSTD (3)),
`http.failure_description` String COMMENT 'description of the failure' CODEC (ZSTD (3)),
`http.client` LowCardinality (FixedString (32)) COMMENT 'name of the http client' CODEC (ZSTD (3)),
`memory_usage.java_max_heap` UInt64 COMMENT 'maximum size of the java heap allocated, in kb' CODEC (T64,
ZSTD (3)),
`memory_usage.java_total_heap` UInt64 COMMENT 'total size of the java heap available for allocation, in KB' CODEC (T64,
ZSTD (3)),
`memory_usage.java_free_heap` UInt64 COMMENT 'free memory available in the java heap, in kb' CODEC (T64,
ZSTD (3)),
`memory_usage.total_pss` UInt64 COMMENT 'total proportional set size - amount of memory used by the process, including shared memory and code. in kb.' CODEC (T64,
ZSTD (3)),
`memory_usage.rss` UInt64 COMMENT 'resident set size - amount of physical memory currently used, in kb' CODEC (T64,
ZSTD (3)),
`memory_usage.native_total_heap` UInt64 COMMENT 'total size of the native heap (memory out of java\'s control) available for allocation, in kb' CODEC (T64,
ZSTD (3)),
`memory_usage.native_free_heap` UInt64 COMMENT 'amount of free memory available in the native heap, in kb' CODEC (T64,
ZSTD (3)),
`memory_usage.interval` UInt64 COMMENT 'interval between two consecutive readings, in msec' CODEC (T64,
ZSTD (3)),
`memory_usage_absolute.max_memory` UInt64 COMMENT 'maximum memory available to the application, in KiB',
`memory_usage_absolute.used_memory` UInt64 COMMENT 'used memory by the application, in KiB',
`memory_usage_absolute.interval` UInt64 COMMENT 'interval between two consecutive readings',
`low_memory.java_max_heap` UInt64 COMMENT 'maximum size of the java heap allocated, in kb' CODEC (T64,
ZSTD (3)),
`low_memory.java_total_heap` UInt64 COMMENT 'total size of the java heap available for allocation, in kb' CODEC (T64,
ZSTD (3)),
`low_memory.java_free_heap` UInt64 COMMENT 'free memory available in the java heap, in kb' CODEC (T64,
ZSTD (3)),
`low_memory.total_pss` UInt64 COMMENT 'total proportional set size - amount of memory used by the process, including shared memory and code. in kb.' CODEC (T64,
ZSTD (3)),
`low_memory.rss` UInt64 COMMENT 'resident set size - amount of physical memory currently used, in kb' CODEC (T64,
ZSTD (3)),
`low_memory.native_total_heap` UInt64 COMMENT 'total size of the native heap (memory out of java' CODEC (T64,
ZSTD (3)),
`low_memory.native_free_heap` UInt64 COMMENT 'amount of free memory available in the native heap, in kb' CODEC (T64,
ZSTD (3)),
`trim_memory.level` LowCardinality (FixedString (64)) COMMENT 'one of the trim memory constants as received by component callback' CODEC (ZSTD (3)),
`cpu_usage.num_cores` UInt8 COMMENT 'number of cores on the device' CODEC (T64,
ZSTD (3)),
`cpu_usage.clock_speed` UInt64 COMMENT 'clock speed of the processor, in hz' CODEC (T64,
ZSTD (3)),
`cpu_usage.start_time` UInt64 COMMENT 'process start time, in jiffies' CODEC (T64,
ZSTD (3)),
`cpu_usage.uptime` UInt64 COMMENT 'time since the device booted, in msec' CODEC (T64,
ZSTD (3)),
`cpu_usage.utime` UInt64 COMMENT 'execution time in user mode, in jiffies' CODEC (T64,
ZSTD (3)),
`cpu_usage.cutime` UInt64 COMMENT 'execution time in user mode with child processes, in jiffies' CODEC (T64,
ZSTD (3)),
`cpu_usage.stime` UInt64 COMMENT 'execution time in kernel mode, in jiffies' CODEC (T64,
ZSTD (3)),
`cpu_usage.cstime` UInt64 COMMENT 'execution time in user mode with child processes, in jiffies' CODEC (T64,
ZSTD (3)),
`cpu_usage.interval` UInt64 COMMENT 'interval between two consecutive readings, in msec' CODEC (T64,
ZSTD (3)),
`cpu_usage.percentage_usage` Float64 COMMENT 'percentage of cpu usage in the interval' CODEC (DoubleDelta,
ZSTD (3)),
`navigation.to` FixedString (128) COMMENT 'destination page or screen where the navigation led to' CODEC (ZSTD (3)),
`navigation.from` FixedString (128) COMMENT 'source page or screen from where the navigation was triggered' CODEC (ZSTD (3)),
`navigation.source` FixedString (128) COMMENT 'how the event was collected example a library or framework name' CODEC (ZSTD (3)),
`screen_view.name` FixedString (128) COMMENT 'name of the screen viewed' CODEC (ZSTD (3)),
`bug_report.description` String COMMENT 'description of the bug report',
`custom.name` LowCardinality (FixedString (64)) COMMENT 'name of the custom event',
`attachments` String COMMENT 'attachment metadata' CODEC (ZSTD (3)),
INDEX team_id_idx `team_id` TYPE bloom_filter(0.01) GRANULARITY 8,
INDEX attribute_app_version_idx `attribute.app_version` TYPE minmax GRANULARITY 2,
INDEX type_idx type TYPE
set
(100) GRANULARITY 2,
INDEX exception_handled_idx `exception.handled` TYPE minmax GRANULARITY 2,
INDEX attribute_os_name_idx `attribute.os_name` TYPE minmax GRANULARITY 2,
INDEX attribute_os_version_idx `attribute.os_version` TYPE minmax GRANULARITY 2,
INDEX inet_country_code_idx `inet.country_code` TYPE minmax GRANULARITY 2,
INDEX attribute_device_name_idx `attribute.device_name` TYPE minmax GRANULARITY 2,
INDEX attribute_device_manufacturer_idx `attribute.device_manufacturer` TYPE minmax GRANULARITY 2,
INDEX attribute_device_locale_idx `attribute.device_locale` TYPE minmax GRANULARITY 2,
INDEX attribute_network_provider_idx `attribute.network_provider` TYPE minmax GRANULARITY 2,
INDEX attribute_network_type_idx `attribute.network_type` TYPE minmax GRANULARITY 2,
INDEX exception_fingerprint_bloom_idx `exception.fingerprint` TYPE bloom_filter GRANULARITY 4,
INDEX anr_fingerprint_bloom_idx `anr.fingerprint` TYPE bloom_filter GRANULARITY 4,
INDEX user_defined_attribute_key_bloom_idx mapKeys (user_defined_attribute) TYPE bloom_filter (0.01) GRANULARITY 16,
INDEX user_defined_attribute_key_minmax_idx mapKeys (user_defined_attribute) TYPE minmax GRANULARITY 16,
INDEX custom_name_bloom_idx `custom.name` TYPE bloom_filter GRANULARITY 2
) ENGINE = ReplacingMergeTree
partition by toYYYYMM(timestamp)
ORDER BY(app_id, session_id, timestamp, id)
SETTINGS index_granularity = 8192
COMMENT 'events master table';

-- migrate:down
drop table if exists events_rmt;
